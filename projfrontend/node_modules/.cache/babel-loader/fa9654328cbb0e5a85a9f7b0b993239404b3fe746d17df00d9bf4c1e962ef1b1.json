{"ast":null,"code":"var _jsxFileName = \"/Users/adititewari/django-react-ecommerce-project/projfrontend/src/core/PaymentB.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport { Navigate } from \"react-router-dom\";\nimport { emptyCart } from \"./helper/CartHelper\";\nimport { getmeToken, processPayment } from \"./helper/PaymentHelper\";\nimport { createOrder } from \"./helper/OrderHelper\";\nimport { isAuthenticated, signout } from \"../auth/helper\";\nimport DropIn from \"braintree-web-drop-in-react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PaymentB = _ref => {\n  _s();\n  let {\n    products,\n    reload = undefined,\n    setReload = f => f\n  } = _ref;\n  const [info, setInfo] = useState({\n    loading: false,\n    success: false,\n    clientToken: null,\n    error: \"something went wrong\",\n    instance: {}\n  });\n  const userId = isAuthenticated && isAuthenticated().user.id;\n  const token = isAuthenticated && isAuthenticated().token;\n  const getToken = (userId, token) => {\n    getmeToken(userId, token).then(info => {\n      if (info.error) {\n        setInfo({\n          ...info,\n          error: info.error\n        });\n        signout(() => {\n          return /*#__PURE__*/_jsxDEV(Navigate, {\n            to: \"/\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 36,\n            columnNumber: 28\n          }, this);\n        });\n      } else {\n        const clientToken = info.clientToken;\n        setInfo({\n          clientToken\n        });\n      }\n    });\n  };\n  useEffect(() => {\n    getToken(userId, token);\n  }, []);\n  const getAmount = () => {\n    let amount = 0;\n    products.map(p => {\n      amount = amount + parseInt(p.price);\n    });\n    return amount;\n  };\n\n  //function when clicking on Pay now button\n  const onPurchase = () => {\n    var _info$instance;\n    setInfo({\n      loading: true\n    });\n    let nonce;\n    console.log(info.instance);\n    let getNonce = (_info$instance = info.instance) === null || _info$instance === void 0 ? void 0 : _info$instance.requestPaymentMethod().then(data => {\n      nonce = data.nonce;\n      console.log(nonce);\n      const paymentData = {\n        paymentMethodNonce: nonce,\n        amount: getAmount()\n      };\n      processPayment(userId, token, paymentData).then(response => {\n        console.log(\"P-1\", response);\n        if (response.error) {\n          if (response.code === '1') {\n            console.log(\"PAYMENT FAILED\");\n            signout(() => {\n              return /*#__PURE__*/_jsxDEV(Navigate, {\n                to: \"/\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 77,\n                columnNumber: 36\n              }, this);\n            });\n          }\n        } else {\n          setInfo({\n            ...info,\n            success: response.success,\n            loading: false\n          });\n          console.log(\"PAYMENT SUCCESSFUL\");\n          let product_names = \"\";\n          products.forEach(function (item) {\n            product_names += item.name + \", \";\n          });\n          const orderData = {\n            products: product_names,\n            transaction_id: response.transaction.id,\n            amount: response.transaction.amount\n          };\n          createOrder(userId, token, orderData).then(response => {\n            if (response.error) {\n              if (response.code === \"1\") {\n                console.log(\"ORDER FAILED\");\n              }\n              signout(() => {\n                return /*#__PURE__*/_jsxDEV(Navigate, {\n                  to: \"/\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 103,\n                  columnNumber: 40\n                }, this);\n              });\n            } else {\n              if (response.success === true) {\n                console.log(\"ORDER PLACED\");\n              }\n            }\n          }).catch(error => {\n            setInfo({\n              loading: false,\n              success: false\n            });\n            console.log(\"ORDER FAILED\", error);\n          });\n          emptyCart(() => {\n            console.log(\"CART IS EMPTIED OUT\");\n          });\n          setReload(!reload);\n        }\n      }).catch(e => console.log(e));\n    }).catch(e => console.log(\"NONCE\", e));\n  };\n  const showbtnDropIn = () => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: info.clientToken !== null && products.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(DropIn, {\n          options: {\n            authorization: info.clientToken\n          },\n          onInstance: instance => info.instance = instance\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onPurchase,\n          className: \"btn btn-block btn-success\",\n          children: \"Pay Now\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 25\n      }, this) : /*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Please login first or add something to cart\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 25\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 13\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: [\"Your bill is $ \", getAmount()]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 13\n    }, this), showbtnDropIn()]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 151,\n    columnNumber: 9\n  }, this);\n};\n_s(PaymentB, \"QiWkoQBsgCGMyPdT1dRmxtL7E54=\");\n_c = PaymentB;\nexport default PaymentB;\nvar _c;\n$RefreshReg$(_c, \"PaymentB\");","map":{"version":3,"names":["React","useEffect","useState","Navigate","emptyCart","getmeToken","processPayment","createOrder","isAuthenticated","signout","DropIn","jsxDEV","_jsxDEV","PaymentB","_ref","_s","products","reload","undefined","setReload","f","info","setInfo","loading","success","clientToken","error","instance","userId","user","id","token","getToken","then","to","fileName","_jsxFileName","lineNumber","columnNumber","getAmount","amount","map","p","parseInt","price","onPurchase","_info$instance","nonce","console","log","getNonce","requestPaymentMethod","data","paymentData","paymentMethodNonce","response","code","product_names","forEach","item","name","orderData","transaction_id","transaction","catch","e","showbtnDropIn","children","length","options","authorization","onInstance","onClick","className","_c","$RefreshReg$"],"sources":["/Users/adititewari/django-react-ecommerce-project/projfrontend/src/core/PaymentB.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Navigate } from \"react-router-dom\";\nimport { emptyCart } from \"./helper/CartHelper\";\nimport { getmeToken, processPayment } from \"./helper/PaymentHelper\";\nimport { createOrder } from \"./helper/OrderHelper\";\nimport { isAuthenticated, signout } from \"../auth/helper\";\n\nimport DropIn from \"braintree-web-drop-in-react\";\n\nconst PaymentB = ({\n    products,\n    reload = undefined,\n    setReload = f => f\n}) => {\n\n    const [info, setInfo] = useState({\n        loading: false,\n        success: false,\n        clientToken: null,\n        error: \"something went wrong\",\n        instance: {}\n\n    });\n    const userId = isAuthenticated && isAuthenticated().user.id;\n    const token = isAuthenticated && isAuthenticated().token;\n\n    const getToken = (userId, token) => {\n        getmeToken(userId, token)\n        .then((info) => {\n            if(info.error){\n                setInfo({\n                    ...info,\n                    error: info.error,\n                });\n                signout(() => {\n                    return <Navigate to=\"/\" />\n                })\n            } else {\n                const clientToken = info.clientToken;\n                setInfo({clientToken})\n            }\n        })\n    }\n\n    useEffect(() => {\n        getToken(userId, token);\n    }, []);\n\n    const getAmount = () => {\n        let amount = 0;\n        products.map((p) => {\n            amount = amount + parseInt(p.price)\n        })\n        return amount;\n    }\n\n    //function when clicking on Pay now button\n    const onPurchase = () => {\n        setInfo({loading: true})\n        let nonce;\n        console.log(info.instance)\n        let getNonce = info.instance?.requestPaymentMethod()\n        .then(data => {\n            nonce = data.nonce;\n            console.log(nonce)\n            const paymentData = {\n                paymentMethodNonce: nonce,\n                amount: getAmount()\n            };\n            processPayment(userId, token, paymentData)\n            .then((response) => {\n                console.log(\"P-1\", response);\n                if(response.error) {\n                    if(response.code === '1') {\n                        console.log(\"PAYMENT FAILED\")\n                        signout(() => {\n                            return <Navigate to=\"/\" />\n                        })\n                    }\n                } else {\n                    setInfo({\n                        ...info, success: response.success, loading: false\n                    })\n                    console.log(\"PAYMENT SUCCESSFUL\")\n                    let product_names = \"\"\n                    products.forEach(function(item){\n                        product_names += item.name + \", \"\n                    });\n\n                    const orderData = {\n                        products: product_names,\n                        transaction_id: response.transaction.id,\n                        amount: response.transaction.amount\n                    }\n\n                    createOrder(userId, token, orderData)\n                    .then((response) => {\n                        if(response.error) {\n                            if(response.code === \"1\"){\n                                console.log(\"ORDER FAILED\")\n                            }\n                            signout(() => {\n                                return <Navigate to=\"/\" />\n                            })\n                        } else {\n                            if (response.success === true){\n                                console.log(\"ORDER PLACED\")\n                            }\n                        }\n                    })\n                    .catch((error) => {\n                        setInfo({loading: false, success: false})\n                        console.log(\"ORDER FAILED\", error)\n                    })\n                    emptyCart(() => {\n                        console.log(\"CART IS EMPTIED OUT\")\n                    })\n\n                    setReload(!reload)\n                        \n                }\n            })\n            .catch(e => console.log(e))\n        })\n        .catch((e) => console.log(\"NONCE\", e))\n\n    }\n\n    const showbtnDropIn = () => {\n        return (\n            <div>\n                {\n                    info.clientToken !== null && products.length > 0 ? \n                    (\n                        <div>\n                            <DropIn options={{authorization: info.clientToken}}\n                            onInstance={instance => info.instance = instance}>\n                            </DropIn>\n                            <button onClick={onPurchase} className=\"btn btn-block btn-success\">Pay Now</button>\n                            \n                        </div>\n                    ) :\n                    (\n                        <h3>Please login first or add something to cart</h3>\n                    )\n                }\n            </div>\n        )\n    }\n    return (\n        <div>\n            <h3>Your bill is $ {getAmount()}</h3>\n            {showbtnDropIn()}\n        </div>\n    )\n}\nexport default PaymentB;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}